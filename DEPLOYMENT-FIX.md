# ๐จ Finance API 500 Error Fix - Deployment Instructions

## ุงููุดููุฉ
ุฃุฎุทุงุก 500 ูู ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงููุงููุฉ ุจุณุจุจ ุญูู `metadata` ุงูููููุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.

## ุงูุญููู ุงููุชุงุญุฉ

### ๐ฅ ุงูุญู ุงูููุฑู (ููุตู ุจู)
1. **ุงุณุชุฎุฏู API ุงูุฅุตูุงุญ ุงูุชููุงุฆู**:
   ```
   POST https://elhamdimport.com/api/fix-database-schema
   ```
   - ุณูุนูู ูุฐุง ุงูู API ุนูู ุฅุถุงูุฉ ุญููู `metadata` ุงูููููุฏุฉ ุชููุงุฆูุงู
   - ูุชุทูุจ ุชุณุฌูู ุงูุฏุฎูู ููุณุคูู

### ๐ง ุงูุญู ุงููุฏูู (ุฅุฐุง ูู ูุนูู ุงูุญู ุงูุชููุงุฆู)
1. **ุดุบูู ุณูุฑูุจุช SQL ูุฏููุงู**:
   ```sql
   -- ุงุณุชุฎุฏู ุงูููู: fix-finance-database.sql
   ALTER TABLE payments ADD COLUMN IF NOT EXISTS metadata JSONB;
   ALTER TABLE transactions ADD COLUMN IF NOT EXISTS metadata JSONB;
   ```

### ๐ฆ ุงูุชุบููุฑุงุช ุงูุชู ุชู ุฅุฌุฑุงุคูุง
1. **ุชุญุณูู API ูููุฏููุนุงุช** (`/api/finance/payments/offline`):
   - ุฅุถุงูุฉ ูุนุงูุฌุฉ ุดุฑุทูุฉ ูุญูู `metadata`
   - ุชุญุณูู ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก

2. **ุชุญุณูู API ูุชุญุฏูุซ ุงูููุงุชูุฑ** (`/api/finance/invoices/[id]/status`):
   - ููุณ ุงูุชุญุณููุงุช ุงููุฐููุฑุฉ ุฃุนูุงู

3. **ุฅุถุงูุฉ API ุฅุตูุงุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช** (`/api/fix-database-schema`):
   - ููุชุญูู ูู ูุฌูุฏ ุญููู `metadata`
   - ุฅุถุงูุฉ ุงูุญููู ุงูููููุฏุฉ ุชููุงุฆูุงู

## ุฎุทูุงุช ุงููุดุฑ ุงูุณุฑูุน

### ุงูุทุฑููุฉ 1: ุนุจุฑ Vercel Dashboard
1. ุงุฐูุจ ุฅูู [Vercel Dashboard](https://vercel.com/dashboard)
2. ุงุฎุชุฑ ูุดุฑูุน `elhamdimport.com`
3. ุงุถุบุท ุนูู "Redeploy" ุฃู "Deploy"
4. ุงูุชุธุฑ ุญุชู ููุชูู ุงููุดุฑ

### ุงูุทุฑููุฉ 2: ุนุจุฑ Git (ุฅุฐุง ูุงู ูุชุตูุงู)
```bash
git push origin master
```

### ุงูุทุฑููุฉ 3: ุนุจุฑ Vercel CLI
```bash
npx vercel --prod
```

## ุจุนุฏ ุงููุดุฑ

### 1. ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญ ุงูุชููุงุฆู
```bash
curl -X POST https://elhamdimport.com/api/fix-database-schema \
  -H "Content-Type: application/json" \
  -H "Cookie: next-auth.session-token=YOUR_SESSION_TOKEN"
```

### 2. ุงุฎุชุจุงุฑ ูุธุงุฆู ุงููุงููุฉ
- ุฌุฑุจ ุชุณุฌูู ุฏูุนุฉ ููุฏูุฉ ุฌุฏูุฏุฉ
- ุฌุฑุจ ุชุญุฏูุซ ุญุงูุฉ ูุงุชูุฑุฉ
- ุชุญูู ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก 500

## ููุงุญุธุงุช ูุงูุฉ
- โ ุงูุชุบููุฑุงุช ุขููุฉ ููุง ุชุคุซุฑ ุนูู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ
- โ API ุงูุฌุฏูุฏ ูุชุนุงูู ูุน ูุฌูุฏ ูุบูุงุจ ุญูู `metadata`
- โ ุฌููุน ุงูุชุบููุฑุงุช ูุชูุงููุฉ ูุน ุงูุฅุตุฏุงุฑ ุงูุญุงูู
- โ๏ธ ูุฌุจ ูุดุฑ ุงูุชุบููุฑุงุช ุฃููุงู ูุจู ุงุฎุชุจุงุฑูุง

## ุงููุณุงุนุฏุฉ
ุฅุฐุง ุงุณุชูุฑุช ุงููุดุงูู:
1. ุชุญูู ูู Vercel Function Logs
2. ุชุฃูุฏ ูู ุฃู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุตูุฉ
3. ุชุญูู ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ ูู Vercel

---
**ุชู ุงูุชุญุฏูุซ:** 22 ุฃูุชูุจุฑ 2024
**ุงูุญุงูุฉ:** ุฌุงูุฒ ูููุดุฑ