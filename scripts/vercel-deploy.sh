#!/bin/bash

# ุณูุฑูุจุช ููุดุฑ ูุดุฑูุน Elhamd Imports ุนูู Vercel

echo "=== ุจุฏุก ุนูููุฉ ูุดุฑ Elhamd Imports ุนูู Vercel ==="

# ุงูุชุญูู ูู ูุฌูุฏ Node.js ู npm
if ! command -v node &> /dev/null; then
    echo "โ Node.js ุบูุฑ ูุซุจุช. ูุฑุฌู ุชุซุจูุชู ุฃููุงู."
    exit 1
fi

if ! command -v npm &> /dev/null; then
    echo "โ npm ุบูุฑ ูุซุจุช. ูุฑุฌู ุชุซุจูุชู ุฃููุงู."
    exit 1
fi

# ุงูุชุญูู ูู ูุฌูุฏ Vercel CLI
if ! command -l vercel &> /dev/null; then
    echo "๐ฆ ุชุซุจูุช Vercel CLI..."
    npm install -g vercel
fi

# ุงูุชุญูู ูู ุฌูุฏุฉ ุงูููุฏ
echo "๐ ุงูุชุญูู ูู ุฌูุฏุฉ ุงูููุฏ..."
npm run lint
if [ $? -ne 0 ]; then
    echo "โ ูุดู ุงูุชุญูู ูู ุฌูุฏุฉ ุงูููุฏ. ูุฑุฌู ุฅุตูุงุญ ุงูุฃุฎุทุงุก ุฃููุงู."
    exit 1
fi

# ุงูุชุญูู ูู ูุฌูุฏ ููู vercel.json
if [ ! -f "vercel.json" ]; then
    echo "โ ููู vercel.json ุบูุฑ ููุฌูุฏ."
    exit 1
fi

# ุงูุชุญูู ูู ูุฌูุฏ ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ุงููุทููุจุฉ
echo "๐ ุงูุชุญูู ูู ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ..."
required_vars=("DATABASE_URL" "NEXTAUTH_URL" "NEXTAUTH_SECRET")
missing_vars=()

for var in "${required_vars[@]}"; do
    if [ -z "${!var}" ]; then
        missing_vars+=("$var")
    fi
done

if [ ${#missing_vars[@]} -gt 0 ]; then
    echo "โ๏ธ  ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ุงูุชุงููุฉ ููููุฏุฉ:"
    for var in "${missing_vars[@]}"; do
        echo "   - $var"
    done
    echo "ูุฑุฌู ุชุนููู ูุฐู ุงููุชุบูุฑุงุช ูุจู ุงููุชุงุจุนุฉ."
    echo "ูุซุงู: export DATABASE_URL='your-database-url'"
    exit 1
fi

# ุจูุงุก ุงููุดุฑูุน ูุญูููุง ููุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก
echo "๐๏ธ  ุจูุงุก ุงููุดุฑูุน ูุญูููุง..."
npm run build
if [ $? -ne 0 ]; then
    echo "โ ูุดู ุจูุงุก ุงููุดุฑูุน ูุญูููุง. ูุฑุฌู ุฅุตูุงุญ ุงูุฃุฎุทุงุก ุฃููุงู."
    exit 1
fi

# ุณุคุงู ุงููุณุชุฎุฏู ุนู ููุน ุงููุดุฑ
echo ""
echo "ุงุฎุชุฑ ููุน ุงููุดุฑ:"
echo "1. ูุดุฑ ุฅูู ุงูุฅูุชุงุฌ (Production)"
echo "2. ูุดุฑ ุชุฌุฑูุจู (Preview)"
read -p "ุฃุฏุฎู ุฑูู ุงูุฎูุงุฑ (1 ุฃู 2): " deploy_type

case $deploy_type in
    1)
        echo "๐ ุจุฏุก ุงููุดุฑ ุฅูู ุงูุฅูุชุงุฌ..."
        vercel --prod
        ;;
    2)
        echo "๐งช ุจุฏุก ุงููุดุฑ ุงูุชุฌุฑูุจู..."
        vercel
        ;;
    *)
        echo "โ ุฎูุงุฑ ุบูุฑ ุตุงูุญ. ูุฑุฌู ุงุฎุชูุงุฑ 1 ุฃู 2."
        exit 1
        ;;
esac

# ุงูุชุญูู ูู ูุฌุงุญ ุงููุดุฑ
if [ $? -eq 0 ]; then
    echo "โ ุชู ุงููุดุฑ ุจูุฌุงุญ!"
    echo ""
    echo "ุงูุฎุทูุงุช ุงูุชุงููุฉ:"
    echo "1. ุชุฃูุฏ ูู ุฅุนุฏุงุฏ ุงููุทุงู ุงููุฎุตุต ูู ููุญุฉ ุชุญูู Vercel"
    echo "2. ุชุญูู ูู ุฃู ุฌููุน ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ูุถุจูุทุฉ ุจุดูู ุตุญูุญ"
    echo "3. ุงุฎุชุจุฑ ุงููููุน ููุชุฃูุฏ ูู ุนูู ุฌููุน ุงูููุฒุงุช"
    echo "4. ุชุฃูุฏ ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ูุนูู ุจุดูู ุตุญูุญ"
else
    echo "โ ูุดู ุนูููุฉ ุงููุดุฑ. ูุฑุฌู ุงูุชุญูู ูู ุงูุณุฌูุงุช ูุฅุนุงุฏุฉ ุงููุญุงููุฉ."
    exit 1
fi

echo ""
echo "=== ุงูุชูุช ุนูููุฉ ุงููุดุฑ ==="